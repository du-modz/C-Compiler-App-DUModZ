name: 24/7 Professional Keep Alive

on:
  schedule:
    # প্রতি ৫ মিনিট পর পর পিং করবে (Render-এর ১৫ মিনিটের স্লিপ টাইম এড়াতে এটি সেরা)
    - cron: '*/5 * * * *' 
    # প্রতি ৬ ঘণ্টা পর পর অটো রিস্টার্ট (অতিরিক্ত মেমোরি ক্লিন করার জন্য)
    - cron: '0 */6 * * *'
  workflow_dispatch: # ম্যানুয়ালি চেক করার জন্য

jobs:
  keep_alive:
    runs-on: ubuntu-latest
    steps:
      - name: Ping App to Keep Awake
        run: |
          # -s (silent), -L (follow redirects), -I (fetch headers)
          STATUS=$(curl -s -o /dev/null -w "%{http_code}" https://c-compiler-app-dumodz.onrender.com/)
          if [ $STATUS -eq 200 ]; then
            echo "Success: App is Online (Status 200)"
          else
            echo "App might be sleeping, waking it up... (Status: $STATUS)"
            curl -s https://c-compiler-app-dumodz.onrender.com/ > /dev/null
          fi

  restart_app:
    # শুধুমাত্র নির্দিষ্ট রিস্টার্ট শিডিউলে রান হবে
    if: github.event.schedule == '0 */6 * * *'
    runs-on: ubuntu-latest
    steps:
      - name: Trigger Render Deploy Hook
        run: |
          if [ -n "${{ secrets.RENDER_DEPLOY_HOOK }}" ]; then
            curl -X POST ${{ secrets.RENDER_DEPLOY_HOOK }}
            echo "Restart request sent to Render."
          else
            echo "Warning: RENDER_DEPLOY_HOOK secret is not set!"
          fi
